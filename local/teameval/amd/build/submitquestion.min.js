define(["jquery","core/templates","core/ajax","core/notification","core/str"],function(a,b,c,d,e){var f;return{submit:function(){var b=0,g=a("#local-teameval-questions").find(".question-container").map(function(){var c=a('<div class="ui-blocker" />');a(this).append(c);var d=a(this).data("question"),e=a.Deferred(),f=d.submit(function(b){var f=a.Deferred();return f.always(function(){c.remove()}),b&&b.methodname?e.resolve({question:d,ajaxCall:b,deferred:f}):(e.resolve(),f.resolve()),f.promise()});return f||b++,e});a.when.apply(a,g).done(function(){var g=[].slice.call(arguments).filter(function(a){return void 0!==a}),h=a.Deferred();g.push({ajaxCall:{methodname:"local_teameval_questionnaire_submitted",args:{cmid:f}},deferred:h});for(var i=c.call(g.map(function(a){return a.ajaxCall})),j=0;j<g.length;j++){var k=i[j],l=g[j].deferred;k.done(l.resolve),k.fail(l.reject),k.progress(l.notify)}var m=a.when.apply(a,i);m.done(function(){if(b>0){var c=1==b?"incompletewarning1":"incompletewarning";e.get_string(c,"local_teameval",b).done(function(b){a(".local-teameval-submit-buttons .results.incomplete").text(b).show("fast")})}else a(".local-teameval-submit-buttons .results.incomplete").hide("fast"),a(".local-teameval-submit-buttons .results.saved").show("fast").delay(5e3).hide("fast")}).fail(d.exception)})},initialise:function(c){f=c,b.render("local_teameval/submit_buttons",{}).done(function(c,d){var e=a(".local-teameval-containerbox");e.append(c),b.runTemplateJS(d),a(".local-teameval-submit-buttons .submit").click(this.submit)}.bind(this))}}});