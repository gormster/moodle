<?xml version="1.0" encoding="UTF-8" ?>
<XMLDB PATH="local/teameval/db" VERSION="20151207" COMMENT="XMLDB file for Moodle local/teameval"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="../../../lib/xmldb/xmldb.xsd"
>
  <TABLES>
    <TABLE NAME="teameval" COMMENT="Settings for teameval instances. No ID because teamevals are 1 to 1 with coursemodules.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true" COMMENT="Useless primary key"/>
        <FIELD NAME="cmid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Course module this teameval is associated with"/>
        <FIELD NAME="enabled" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="If evaluation is enabled for this course module"/>
        <FIELD NAME="public" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="0" SEQUENCE="false" COMMENT="If the questionnaire for this puppy is public. Otherwise it is only available within the course or course category depending on site-wide settings."/>
        <FIELD NAME="self" TYPE="int" LENGTH="2" NOTNULL="true" DEFAULT="1" SEQUENCE="false" COMMENT="True if self-assessment is enabled for this team evaluation"/>
        <FIELD NAME="fraction" TYPE="number" LENGTH="4" NOTNULL="true" DEFAULT="50" SEQUENCE="false" DECIMALS="2" COMMENT="The percentage of the evaluation score that is used to calculate a user's final score."/>
        <FIELD NAME="noncompletionpenalty" TYPE="number" LENGTH="4" NOTNULL="true" DEFAULT="10" SEQUENCE="false" DECIMALS="2" COMMENT="The penalty for non-completion of the evaluation form."/>
        <FIELD NAME="deadline" TYPE="int" LENGTH="10" NOTNULL="false" SEQUENCE="false" COMMENT="Last possible date for submission of the questionnaire by users."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="cmiduq" TYPE="unique" FIELDS="cmid"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="teameval_questions" COMMENT="Questions for teameval instances.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="cmid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Coursemodule/teameval id"/>
        <FIELD NAME="qtype" TYPE="char" LENGTH="255" NOTNULL="true" SEQUENCE="false" COMMENT="Subplugin identifier for teamevalquestion subplugin"/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Instance id for the subplugin's own database tables"/>
        <FIELD NAME="ordinal" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="Ordering number for questions"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="cmid" TYPE="foreign" FIELDS="cmid" REFTABLE="teameval" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="teameval_responses" COMMENT="Responses to teameval questionnaires. Why the backwards normalisation? It's more efficient than asking every subplugin for its responses, plus this way we're not relying on subplugins to store this information correctly; they only have their own data to worry about.">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="questionid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the question this response belongs to"/>
        <FIELD NAME="userid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="User who gave this response"/>
        <FIELD NAME="responseid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID for the teamevalresponse subplugin to use to refer to its own database tables"/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="questionid" TYPE="foreign" FIELDS="questionid" REFTABLE="teameval_questions" REFFIELDS="id"/>
        <KEY NAME="userid" TYPE="foreign" FIELDS="userid" REFTABLE="user" REFFIELDS="id"/>
      </KEYS>
    </TABLE>
    <TABLE NAME="teameval_release" COMMENT="Mark release objects">
      <FIELDS>
        <FIELD NAME="id" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="true"/>
        <FIELD NAME="cmid" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the course module to which this teameval belongs"/>
        <FIELD NAME="level" TYPE="int" LENGTH="2" NOTNULL="true" SEQUENCE="false" COMMENT="0 = RELEASE_ALL
1 = RELEASE_GROUP
2 = RELEASE_USER"/>
        <FIELD NAME="target" TYPE="int" LENGTH="10" NOTNULL="true" SEQUENCE="false" COMMENT="ID of the group or user whose marks are being released. 0 if level == RELEASE_ALL."/>
      </FIELDS>
      <KEYS>
        <KEY NAME="primary" TYPE="primary" FIELDS="id"/>
        <KEY NAME="combo" TYPE="unique" FIELDS="cmid, level, target"/>
      </KEYS>
      <INDEXES>
        <INDEX NAME="cmid" UNIQUE="false" FIELDS="cmid"/>
      </INDEXES>
    </TABLE>
  </TABLES>
</XMLDB>