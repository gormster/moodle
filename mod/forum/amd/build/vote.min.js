define(["jquery","core/ajax","core/notification"],function(a,b,c){function d(a,e,f,g,h){if(a.hasClass(g))return void d(a,0,f,h,g);var i=a.hasClass(h);a.removeClass(h),e&&a.addClass(g),f.rating=e;var j=b.call([{methodname:"core_rating_add_rating",args:f}]);j[0].then(function(b){if(!b.success)throw b.warnings;a.find(".agg").text(b.aggregate)}).fail(function(b){a.removeClass(g),i&&a.addClass(h),c.exception(b)})}return{initpost:function(b,c){var e=a("#"+b);e.on("click",".upvote",function(b){var e=a(b.delegateTarget);d(e,1,c,"upvoted","downvoted")}),e.on("click",".downvote",function(b){var e=a(b.delegateTarget);d(e,-1,c,"downvoted","upvoted")})}}});